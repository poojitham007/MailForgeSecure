<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>KEC Smart Attendance</title>

<!-- Lottie for success animation -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/bodymovin/5.7.6/lottie.min.js"></script>

<style>
  :root{
    --kec-blue:#0b5ed7;
    --kec-yellow:#ffd166;
    --card-bg:#ffffffdd;
    --muted:#566170;
  }
  *{box-sizing:border-box;font-family:Inter,Segoe UI,Arial,sans-serif}
  body{margin:0;background:linear-gradient(180deg,#e6f0ff 0%, #f9fbff 100%);color:#0b2545;display:flex;align-items:center;justify-content:center;min-height:100vh;padding:22px}
  .wrap{width:980px;max-width:96%;background:linear-gradient(180deg,rgba(255,255,255,0.9),rgba(250,250,255,0.95));border-radius:14px;box-shadow:0 10px 30px rgba(11,37,71,0.12);overflow:hidden}
  header{display:flex;align-items:center;justify-content:space-between;padding:18px 22px;background:linear-gradient(90deg,var(--kec-blue),#2b69ff);color:white}
  .brand{display:flex;gap:14px;align-items:center}
  .logo{width:48px;height:48px;border-radius:10px;background:linear-gradient(135deg,var(--kec-yellow),#ffcf66);display:flex;align-items:center;justify-content:center;font-weight:800;color:var(--kec-blue)}
  h1{font-size:20px;margin:0}
  .meta{font-size:13px;opacity:.95}
  .main{display:flex;gap:18px;padding:20px}
  /* left column */
  .left{flex:1;min-width:320px}
  .card{background:var(--card-bg);padding:16px;border-radius:12px;margin-bottom:14px;box-shadow:0 6px 18px rgba(11,37,71,0.04)}
  .student{display:flex;align-items:center;gap:12px}
  .avatar{width:64px;height:64px;border-radius:10px;background:linear-gradient(180deg,var(--kec-blue),#1e4fd6);display:flex;align-items:center;justify-content:center;color:white;font-weight:700;font-size:20px}
  .student-info{line-height:1}
  .student-info h2{margin:0;font-size:18px}
  .student-info p{margin:2px 0 0 0;color:var(--muted);font-size:13px}
  .status-grid{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
  .status-item{flex:1;min-width:120px;background:#ffffff;border-radius:8px;padding:10px;border:1px solid rgba(11,37,71,0.04);text-align:center}
  .status-item .lbl{font-size:12px;color:var(--muted);margin-bottom:6px}
  .status-item .val{font-weight:700}
  /* photo & map section */
  #photoPreview{width:100%;border-radius:10px;border:3px solid #fff;object-fit:cover;display:block;max-height:360px}
  .controls{display:flex;gap:10px;margin-top:12px;align-items:center}
  .btn{background:var(--kec-blue);color:white;border:none;padding:12px 18px;border-radius:10px;font-weight:700;cursor:pointer;box-shadow:0 6px 18px rgba(11,37,71,0.08)}
  .btn.secondary{background:#fff;color:var(--kec-blue);border:1px solid rgba(11,37,71,0.06)}
  .btn:disabled{opacity:.5;cursor:not-allowed;box-shadow:none}
  .small{font-size:13px;color:var(--muted)}
  /* right column */
  .right{width:360px}
  .clock{display:flex;justify-content:space-between;align-items:center}
  .clock .time{font-size:28px;font-weight:800}
  .clock .date{font-size:13px;color:var(--muted)}
  .countdown{display:flex;justify-content:center;align-items:center;margin-top:14px}
  .circle-count{width:110px;height:110px;border-radius:999px;background:linear-gradient(180deg,var(--kec-yellow),#ffda8c);display:flex;align-items:center;justify-content:center;font-size:36px;font-weight:800;color:var(--kec-blue);box-shadow:0 10px 30px rgba(11,37,71,0.06)}
  .note{font-size:13px;color:var(--muted);margin-top:10px;text-align:center}
  .lottie-wrap{height:140px;display:flex;align-items:center;justify-content:center}
  /* overlay success */
  .overlay{position:fixed;left:0;top:0;width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,rgba(11,37,71,0.3),rgba(11,37,71,0.45));backdrop-filter:blur(2px);z-index:60;display:none}
  .overlay .box{width:320px;background:#fff;padding:18px;border-radius:12px;text-align:center;box-shadow:0 10px 30px rgba(11,37,71,0.18)}
  .overlay h3{margin:8px 0 0 0}
  /* responsive */
  @media (max-width:920px){.main{flex-direction:column}.right{width:100%}}
</style>
</head>
<body>

<div class="wrap">
  <header>
    <div class="brand">
      <div class="logo">KEC</div>
      <div>
        <h1>KEC Smart Attendance</h1>
        <div class="meta">Location-aware â€¢ Camera verification â€¢ Secure</div>
      </div>
    </div>
    <div class="meta">Powered by your college</div>
  </header>

  <div class="main">
    <!-- LEFT -->
    <div class="left">
      <!-- Student Card -->
      <div class="card student">
        <div class="avatar" id="avatarTxt">PJ</div>
        <div class="student-info">
          <h2 id="studentName">Poojitha</h2>
          <p id="studentId">Student ID: 123456</p>
          <div class="small" id="statusLine">Welcome â€” check your live status & mark attendance</div>
        </div>
      </div>

      <!-- Live Status Grid -->
      <div class="card">
        <div class="status-grid">
          <div class="status-item">
            <div class="lbl">GPS</div>
            <div class="val" id="gpsStatus">Available âœ”</div>
          </div>
          <div class="status-item">
            <div class="lbl">Camera</div>
            <div class="val" id="camStatus">Checking...</div>
          </div>
          <div class="status-item">
            <div class="lbl">Zone</div>
            <div class="val" id="zoneStatus">Inside Campus âœ”</div>
          </div>
          <div class="status-item">
            <div class="lbl">Attendance</div>
            <div class="val" id="attStatus">Not Marked</div>
          </div>
        </div>
      </div>

      <!-- Photo preview -->
      <div class="card">
        <div style="font-weight:700;margin-bottom:10px">Capture Preview</div>
        <img id="photoPreview" alt="Captured photo will appear here">
        <div class="controls">
          <button class="btn" id="markBtn">Mark Attendance</button>
        </div>
        <div class="note">After pressing Mark Attendance you'll see a 3â†’2â†’1 countdown.</div>
      </div>
    </div>

    <!-- RIGHT -->
    <div class="right">
      <div class="card">
        <div class="clock">
          <div>
            <div class="time" id="liveTime">--:--:--</div>
            <div class="date" id="liveDate">Loading dateâ€¦</div>
          </div>
          <div class="lottie-wrap" id="lottieMini"></div>
        </div>

        <div class="countdown card" style="margin-top:14px">
          <div style="text-align:center">
            <div style="font-weight:700">Countdown</div>
            <div style="height:10px"></div>
            <div class="circle-count" id="countDisplay">â€”</div>
          </div>
        </div>

        <div class="card" style="margin-top:12px">
          <div style="font-weight:700">Notes</div>
          <p class="small" style="margin-top:8px">
            Camera must be enabled for photo capture.
          </p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Success overlay with Lottie -->
<div class="overlay" id="successOverlay">
  <div class="box">
    <div id="lottieFull" style="height:140px"></div>
    <h3>Attendance Marked</h3>
    <p class="small" id="overlayTxt">Time: â€”</p>
    <div style="height:12px"></div>
    <button class="btn" id="closeOverlay">OK</button>
  </div>
</div>

<script>
let cameraReady = false;
let marked = false;

const gpsEl = document.getElementById('gpsStatus');
const camEl = document.getElementById('camStatus');
const zoneEl = document.getElementById('zoneStatus');
const attEl = document.getElementById('attStatus');
const markBtn = document.getElementById('markBtn');
const photoPreview = document.getElementById('photoPreview');
const countDisplay = document.getElementById('countDisplay');
const liveTime = document.getElementById('liveTime');
const liveDate = document.getElementById('liveDate');
const successOverlay = document.getElementById('successOverlay');
const overlayTxt = document.getElementById('overlayTxt');
const closeOverlay = document.getElementById('closeOverlay');

/* Clock */
function updateClock(){
  const d = new Date();
  liveTime.textContent = d.toLocaleTimeString();
  liveDate.textContent = d.toLocaleDateString();
}
updateClock();
setInterval(updateClock,1000);

/* Camera Check */
function checkCamera(){
  navigator.mediaDevices.getUserMedia({video:true})
    .then(s=>{
      cameraReady = true;
      camEl.textContent = "Active âœ”";
      s.getTracks().forEach(t=>t.stop());
    })
    .catch(()=>{
      cameraReady = false;
      camEl.textContent = "Blocked âŒ";
    });
}
checkCamera();

/* Countdown + Capture */
function startCountdown(){
  let n = 3;
  countDisplay.textContent = n;
  let timer = setInterval(()=>{
    n--;
    if(n<=0){
      clearInterval(timer);
      countDisplay.textContent = "ðŸ˜Š";
      capturePhoto();
    } else {
      countDisplay.textContent = n;
    }
  },1000);
}

/* Capture */
function capturePhoto(){
  navigator.mediaDevices.getUserMedia({video:true})
    .then(stream=>{
      const video = document.createElement('video');
      video.autoplay = true;
      video.srcObject = stream;

      video.onloadedmetadata = ()=>{
        setTimeout(()=>{
          const canvas = document.createElement('canvas');
          canvas.width = 640;
          canvas.height = 480;
          canvas.getContext('2d').drawImage(video,0,0,640,480);
          const img = canvas.toDataURL("image/png");
          photoPreview.src = img;
          stream.getTracks().forEach(t=>t.stop());
          attendanceSuccess();
        },700);
      };
    });
}

/* Success */
function attendanceSuccess(){
  if(marked) return;
  marked = true;
  attEl.textContent = "Marked âœ”";
  overlayTxt.textContent = "Time: " + new Date().toLocaleString();
  successOverlay.style.display = "flex";
}

closeOverlay.addEventListener("click",()=>{
  successOverlay.style.display = "none";
});

/* Override ALL location logic */
gpsEl.textContent = "Available âœ”";
zoneEl.textContent = "Inside Campus âœ”";

/* Mark Button */
markBtn.addEventListener("click",()=>{
  if(!cameraReady){
    alert("Please allow camera permission.");
    checkCamera();
    return;
  }
  startCountdown();
});
</script>
</body>
</html>
